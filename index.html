<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ–±—É—Å—ã –û–ª—ë–∫–º–∏–Ω—Å–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            background: #1976D2;
            color: white;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.25rem;
            font-weight: 500;
        }
        
        .header-actions {
            display: flex;
            gap: 8px;
        }
        
        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .btn-primary {
            background: #1976D2;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1565C0;
        }
        
        .btn-secondary {
            background: #E3F2FD;
            color: #1976D2;
        }
        
        .btn-secondary:hover {
            background: #BBDEFB;
        }
        
        .btn-danger {
            background: #FFEBEE;
            color: #C62828;
        }
        
        .btn-danger:hover {
            background: #FFCDD2;
        }
        
        .btn-small {
            padding: 4px 12px;
            font-size: 0.75rem;
        }
        
        /* Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 16px;
        }
        
        /* Announcements */
        .announcements-section {
            margin-bottom: 24px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .section-title {
            font-size: 1.125rem;
            font-weight: 500;
            color: #424242;
        }
        
        .announcement-card {
            background: #FFF3E0;
            border-left: 4px solid #FF9800;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            position: relative;
        }
        
        .announcement-card.urgent {
            background: #FFEBEE;
            border-left-color: #F44336;
        }
        
        .announcement-title {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .announcement-text {
            font-size: 0.875rem;
            color: #666;
        }
        
        .announcement-date {
            font-size: 0.75rem;
            color: #999;
            margin-top: 4px;
        }
        
        .announcement-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.25rem;
            line-height: 1;
        }
        
        .announcement-delete:hover {
            color: #F44336;
        }
        
        /* Routes List */
        .routes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .route-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .route-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .route-number {
            width: 56px;
            height: 56px;
            background: #E3F2FD;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #1976D2;
            flex-shrink: 0;
        }
        
        .route-info {
            flex: 1;
        }
        
        .route-name {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .route-interval {
            font-size: 0.875rem;
            color: #666;
        }
        
        .route-arrow {
            color: #1976D2;
            font-size: 1.5rem;
        }
        
        /* Route Detail */
        .route-detail {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .detail-title {
            font-size: 1.25rem;
            font-weight: 500;
        }
        
        .detail-actions {
            display: flex;
            gap: 8px;
        }
        
        /* Toggle */
        .toggle-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .toggle-btn {
            padding: 8px 24px;
            border: 2px solid #1976D2;
            background: white;
            color: #1976D2;
            border-radius: 24px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .toggle-btn.active {
            background: #1976D2;
            color: white;
        }
        
        /* Schedule Info */
        .schedule-info {
            text-align: center;
            margin-bottom: 16px;
            padding: 12px;
            background: #F5F5F5;
            border-radius: 8px;
        }
        
        .schedule-info h3 {
            margin-bottom: 8px;
        }
        
        .schedule-info p {
            color: #666;
            font-size: 0.875rem;
        }
        
        /* Stops */
        .stops-section {
            margin-bottom: 24px;
        }
        
        .stops-title {
            font-weight: 500;
            margin-bottom: 12px;
            color: #424242;
        }
        
        .stop-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .stop-number {
            width: 24px;
            color: #1976D2;
            font-weight: 500;
        }
        
        /* Times Grid */
        .times-section {
            margin-bottom: 24px;
        }
        
        .times-title {
            font-weight: 500;
            margin-bottom: 12px;
            color: #424242;
        }
        
        .times-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .time-item {
            padding: 8px;
            text-align: center;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .time-item.future {
            background: #E3F2FD;
            color: #1976D2;
        }
        
        .time-item.past {
            background: #F5F5F5;
            color: #999;
        }
        
        /* Next Bus */
        .next-bus {
            background: #E8F5E9;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            margin-bottom: 16px;
        }
        
        .next-bus-label {
            font-size: 0.875rem;
            color: #2E7D32;
            margin-bottom: 4px;
        }
        
        .next-bus-time {
            font-size: 2rem;
            font-weight: bold;
            color: #1B5E20;
        }
        
        .next-bus.no-bus {
            background: #FFEBEE;
        }
        
        .next-bus.no-bus .next-bus-label,
        .next-bus.no-bus .next-bus-time {
            color: #C62828;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }
        
        .modal {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 500;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            padding: 16px;
        }
        
        .modal-footer {
            padding: 16px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        
        /* Form */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }
        
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #1976D2;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-hint {
            font-size: 0.75rem;
            color: #666;
            margin-top: 4px;
        }
        
        /* Hidden */
        .hidden {
            display: none !important;
        }
        
        /* Admin Actions */
        .admin-actions {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .admin-actions-title {
            font-weight: 500;
            margin-bottom: 12px;
            color: #424242;
        }
        
        .admin-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .times-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .header h1 {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1 id="pageTitle">–ê–≤—Ç–æ–±—É—Å—ã –û–ª—ë–∫–º–∏–Ω—Å–∫–∞</h1>
            <div class="header-actions">
                <button class="btn btn-secondary btn-small" onclick="showAdminPanel()">‚öôÔ∏è –ê–¥–º–∏–Ω</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Admin Actions -->
        <div id="adminPanel" class="admin-actions hidden">
            <div class="admin-actions-title">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
            <div class="admin-buttons">
                <button class="btn btn-primary btn-small" onclick="showAddRouteModal()">‚ûï –ú–∞—Ä—à—Ä—É—Ç</button>
                <button class="btn btn-primary btn-small" onclick="showAddAnnouncementModal()">üì¢ –û–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
                <button class="btn btn-secondary btn-small" onclick="exportData()">üíæ –°–∫–∞—á–∞—Ç—å JSON</button>
                <button class="btn btn-secondary btn-small" onclick="document.getElementById('importFile').click()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</button>
                <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
                <button class="btn btn-danger btn-small" onclick="resetData()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                <button class="btn btn-secondary btn-small" onclick="hideAdminPanel()">‚úñÔ∏è –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <!-- Announcements -->
        <div class="announcements-section">
            <div class="section-header">
                <h2 class="section-title">üì¢ –û–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
            </div>
            <div id="announcementsList"></div>
        </div>

        <!-- Routes List -->
        <div id="routesList" class="routes-list"></div>

        <!-- Route Detail -->
        <div id="routeDetail" class="route-detail hidden"></div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle" class="modal-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody" class="modal-body"></div>
            <div id="modalFooter" class="modal-footer"></div>
        </div>
    </div>

    <script>
        // Default data
        const defaultRoutes = [
            {
                id: 1,
                number: "1",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –î–∞—á–∞",
                interval: "20-25 –º–∏–Ω",
                weekday: {
                    start: "07:00",
                    end: "21:07",
                    times: ["07:00", "07:42", "07:59", "08:32", "08:49", "10:07", "10:32", "10:57", "11:47", "12:37", "13:27", "14:17", "16:07", "16:57", "17:47", "18:37", "19:27", "20:17", "21:07"]
                },
                weekend: {
                    start: "07:00",
                    end: "20:42",
                    times: ["07:00", "07:34", "07:50", "08:24", "08:40", "09:30", "09:57", "10:47", "11:22", "12:12", "13:02", "13:52", "14:42", "15:32", "16:32", "17:22", "18:12", "19:02", "19:27", "20:42"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å", "–®–∫–æ–ª–∞ ‚Ññ2", "–î–∞—á–∞"]
            },
            {
                id: 2,
                number: "2",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ê–≤–∏–∞–ø–æ—Ä—Ç",
                interval: "40-60 –º–∏–Ω",
                weekday: {
                    start: "07:00",
                    end: "20:30",
                    times: ["07:00", "07:40", "08:20", "09:30", "11:00", "12:20", "13:00", "13:40", "14:40", "16:40", "17:40", "18:00", "18:40", "19:00", "20:10", "20:30"]
                },
                weekend: {
                    start: "07:40",
                    end: "20:30",
                    times: ["07:40", "08:20", "12:20", "13:00", "13:40", "14:40", "16:40", "17:20", "18:00", "18:40", "19:00", "20:10", "20:30"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫", "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", "–ê–≤–∏–∞–ø–æ—Ä—Ç"]
            },
            {
                id: 5,
                number: "5",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ü–ù–î–ò",
                interval: "25-35 –º–∏–Ω",
                weekday: {
                    start: "07:25",
                    end: "20:17",
                    times: ["07:25", "08:15", "09:05", "09:42", "11:22", "12:12", "13:02", "13:52", "14:42", "15:42", "16:32", "17:22", "18:12", "19:02", "20:17"]
                },
                weekend: {
                    start: "07:25",
                    end: "19:52",
                    times: ["07:25", "08:15", "09:05", "10:32", "11:22", "12:12", "13:02", "13:52", "15:42", "16:32", "17:22", "18:12", "19:02", "19:52"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–®–∫–æ–ª–∞ ‚Ññ3", "–ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞", "–ü–ù–î–ò"]
            },
            {
                id: 6,
                number: "6",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏ ‚Äî –ü–æ–ø–æ–≤—Å–∫–∏–µ –ø–æ–ª—è",
                interval: "30-90 –º–∏–Ω",
                weekday: {
                    start: "07:20",
                    end: "18:10",
                    times: ["07:20", "08:15", "12:30", "13:30", "15:00", "17:00", "18:10"]
                },
                weekend: {
                    start: "07:20",
                    end: "13:30",
                    times: ["07:20", "12:30", "13:30"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏", "–ü–æ–ø–æ–≤—Å–∫–∏–µ –ø–æ–ª—è"]
            },
            {
                id: 7,
                number: "7",
                name: "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ù–µ—Ñ—Ç–µ–±–∞–∑–∞",
                interval: "60-90 –º–∏–Ω",
                weekday: {
                    start: "07:05",
                    end: "18:35",
                    times: ["07:05", "08:55", "12:30", "14:30", "16:20", "17:55"]
                },
                weekend: {
                    start: "07:15",
                    end: "15:10",
                    times: ["07:15", "12:30", "14:30"]
                },
                stops: ["–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–ü—Ä–æ–º–∑–æ–Ω–∞", "–ù–µ—Ñ—Ç–µ–±–∞–∑–∞"]
            }
        ];

        // State
        let routes = [];
        let announcements = [];
        let currentRoute = null;

        // Initialize
        function init() {
            loadData();
            renderRoutes();
            renderAnnouncements();
        }

        // Load data from localStorage
        function loadData() {
            const savedRoutes = localStorage.getItem('busRoutes');
            const savedAnnouncements = localStorage.getItem('busAnnouncements');
            
            routes = savedRoutes ? JSON.parse(savedRoutes) : [...defaultRoutes];
            announcements = savedAnnouncements ? JSON.parse(savedAnnouncements) : [];
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('busRoutes', JSON.stringify(routes));
            localStorage.setItem('busAnnouncements', JSON.stringify(announcements));
        }

        // Render routes list
        function renderRoutes() {
            const container = document.getElementById('routesList');
            container.innerHTML = routes.map(route => `
                <div class="route-card" onclick="showRouteDetail(${route.id})">
                    <div class="route-number">${route.number}</div>
                    <div class="route-info">
                        <div class="route-name">${route.name}</div>
                        <div class="route-interval">–ò–Ω—Ç–µ—Ä–≤–∞–ª: ${route.interval}</div>
                    </div>
                    <div class="route-arrow">‚Ä∫</div>
                </div>
            `).join('');
        }

        // Render announcements
        function renderAnnouncements() {
            const container = document.getElementById('announcementsList');
            
            if (announcements.length === 0) {
                container.innerHTML = '<p style="color: #999; font-size: 0.875rem;">–ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>';
                return;
            }
            
            container.innerHTML = announcements.map((ann, index) => `
                <div class="announcement-card ${ann.urgent ? 'urgent' : ''}">
                    <button class="announcement-delete" onclick="deleteAnnouncement(${index}); event.stopPropagation();">&times;</button>
                    <div class="announcement-title">${ann.title}</div>
                    <div class="announcement-text">${ann.text}</div>
                    <div class="announcement-date">${ann.date}</div>
                </div>
            `).join('');
        }

        // Show route detail
        function showRouteDetail(routeId) {
            currentRoute = routes.find(r => r.id === routeId);
            if (!currentRoute) return;

            document.getElementById('routesList').classList.add('hidden');
            document.querySelector('.announcements-section').classList.add('hidden');
            
            const detail = document.getElementById('routeDetail');
            detail.classList.remove('hidden');
            
            renderRouteDetail();
        }

        // Render route detail
        function renderRouteDetail(isWeekend = false) {
            if (!currentRoute) return;
            
            const schedule = isWeekend ? currentRoute.weekend : currentRoute.weekday;
            const nextBus = findNextBus(schedule.times);
            
            const container = document.getElementById('routeDetail');
            container.innerHTML = `
                <div class="detail-header">
                    <h2 class="detail-title">–ú–∞—Ä—à—Ä—É—Ç ${currentRoute.number}</h2>
                    <div class="detail-actions">
                        <button class="btn btn-secondary btn-small" onclick="showEditRouteModal()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger btn-small" onclick="deleteRoute()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
                
                <div class="toggle-container">
                    <button class="toggle-btn ${!isWeekend ? 'active' : ''}" onclick="renderRouteDetail(false)">–ë—É–¥–Ω–∏</button>
                    <button class="toggle-btn ${isWeekend ? 'active' : ''}" onclick="renderRouteDetail(true)">–í—ã—Ö–æ–¥–Ω—ã–µ</button>
                </div>
                
                <div class="schedule-info">
                    <h3>${currentRoute.name}</h3>
                    <p>–ò–Ω—Ç–µ—Ä–≤–∞–ª: ${currentRoute.interval}</p>
                    <p>–†–∞–±–æ—Ç–∞–µ—Ç: ${schedule.start} ‚Äî ${schedule.end}</p>
                </div>
                
                ${nextBus ? `
                    <div class="next-bus">
                        <div class="next-bus-label">–ë–ª–∏–∂–∞–π—à–∏–π –∞–≤—Ç–æ–±—É—Å</div>
                        <div class="next-bus-time">${nextBus}</div>
                    </div>
                ` : `
                    <div class="next-bus no-bus">
                        <div class="next-bus-label">–ë–ª–∏–∂–∞–π—à–∏–π –∞–≤—Ç–æ–±—É—Å</div>
                        <div class="next-bus-time">–ù–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç</div>
                    </div>
                `}
                
                <div class="stops-section">
                    <div class="stops-title">–û—Å—Ç–∞–Ω–æ–≤–∫–∏:</div>
                    ${currentRoute.stops.map((stop, i) => `
                        <div class="stop-item">
                            <span class="stop-number">${i + 1}.</span>
                            <span>${stop}</span>
                        </div>
                    `).join('')}
                </div>
                
                <div class="times-section">
                    <div class="times-title">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</div>
                    <div class="times-grid">
                        ${schedule.times.map(time => {
                            const isPast = isTimePast(time);
                            return `<div class="time-item ${isPast ? 'past' : 'future'}">${time}</div>`;
                        }).join('')}
                    </div>
                </div>
                
                <button class="btn btn-secondary" style="width: 100%; margin-top: 16px;" onclick="backToList()">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
            `;
        }

        // Check if time is past
        function isTimePast(timeStr) {
            const now = new Date();
            const [hours, minutes] = timeStr.split(':').map(Number);
            const time = new Date();
            time.setHours(hours, minutes, 0);
            return time < now;
        }

        // Find next bus
        function findNextBus(times) {
            const now = new Date();
            for (const timeStr of times) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                const time = new Date();
                time.setHours(hours, minutes, 0);
                if (time >= now) return timeStr;
            }
            return null;
        }

        // Back to list
        function backToList() {
            document.getElementById('routeDetail').classList.add('hidden');
            document.getElementById('routesList').classList.remove('hidden');
            document.querySelector('.announcements-section').classList.remove('hidden');
            currentRoute = null;
        }

        // Admin panel
        function showAdminPanel() {
            document.getElementById('adminPanel').classList.remove('hidden');
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').classList.add('hidden');
        }

        // Modal functions
        function showModal(title, body, footer) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modalFooter').innerHTML = footer;
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // Add route modal
        function showAddRouteModal() {
            const body = `
                <div class="form-group">
                    <label class="form-label">–ù–æ–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∞</label>
                    <input type="text" id="routeNumber" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 8">
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="routeName" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª ‚Äî –ë–æ–ª—å–Ω–∏—Ü–∞">
                </div>
                <div class="form-group">
                    <label class="form-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª</label>
                    <input type="text" id="routeInterval" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 20-30 –º–∏–Ω">
                </div>
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–±—É–¥–Ω–∏)</label>
                    <textarea id="weekdayTimes" class="form-textarea" placeholder="07:00, 07:30, 08:00..."></textarea>
                    <div class="form-hint">–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</div>
                </div>
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≤—ã—Ö–æ–¥–Ω—ã–µ)</label>
                    <textarea id="weekendTimes" class="form-textarea" placeholder="08:00, 09:00, 10:00..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–û—Å—Ç–∞–Ω–æ–≤–∫–∏</label>
                    <textarea id="routeStops" class="form-textarea" placeholder="–û—Å—Ç–∞–Ω–æ–≤–∫–∞ 1, –û—Å—Ç–∞–Ω–æ–≤–∫–∞ 2, –û—Å—Ç–∞–Ω–æ–≤–∫–∞ 3..."></textarea>
                    <div class="form-hint">–í–≤–µ–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveNewRoute()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            `;
            
            showModal('–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç', body, footer);
        }

        // Save new route
        function saveNewRoute() {
            const number = document.getElementById('routeNumber').value.trim();
            const name = document.getElementById('routeName').value.trim();
            const interval = document.getElementById('routeInterval').value.trim();
            const weekdayTimesStr = document.getElementById('weekdayTimes').value.trim();
            const weekendTimesStr = document.getElementById('weekendTimes').value.trim();
            const stopsStr = document.getElementById('routeStops').value.trim();
            
            if (!number || !name) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞');
                return;
            }
            
            const weekdayTimes = weekdayTimesStr ? weekdayTimesStr.split(',').map(t => t.trim()) : [];
            const weekendTimes = weekendTimesStr ? weekendTimesStr.split(',').map(t => t.trim()) : [];
            const stops = stopsStr ? stopsStr.split(',').map(s => s.trim()) : [];
            
            const newRoute = {
                id: Date.now(),
                number,
                name,
                interval: interval || '‚Äî',
                weekday: {
                    start: weekdayTimes[0] || '‚Äî',
                    end: weekdayTimes[weekdayTimes.length - 1] || '‚Äî',
                    times: weekdayTimes
                },
                weekend: {
                    start: weekendTimes[0] || '‚Äî',
                    end: weekendTimes[weekendTimes.length - 1] || '‚Äî',
                    times: weekendTimes
                },
                stops
            };
            
            routes.push(newRoute);
            saveData();
            renderRoutes();
            closeModal();
        }

        // Edit route modal
        function showEditRouteModal() {
            if (!currentRoute) return;
            
            const body = `
                <div class="form-group">
                    <label class="form-label">–ù–æ–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∞</label>
                    <input type="text" id="editRouteNumber" class="form-input" value="${currentRoute.number}">
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="editRouteName" class="form-input" value="${currentRoute.name}">
                </div>
                <div class="form-group">
                    <label class="form-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª</label>
                    <input type="text" id="editRouteInterval" class="form-input" value="${currentRoute.interval}">
                </div>
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–±—É–¥–Ω–∏)</label>
                    <textarea id="editWeekdayTimes" class="form-textarea">${currentRoute.weekday.times.join(', ')}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≤—ã—Ö–æ–¥–Ω—ã–µ)</label>
                    <textarea id="editWeekendTimes" class="form-textarea">${currentRoute.weekend.times.join(', ')}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–û—Å—Ç–∞–Ω–æ–≤–∫–∏</label>
                    <textarea id="editRouteStops" class="form-textarea">${currentRoute.stops.join(', ')}</textarea>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="updateRoute()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            `;
            
            showModal('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç', body, footer);
        }

        // Update route
        function updateRoute() {
            if (!currentRoute) return;
            
            const number = document.getElementById('editRouteNumber').value.trim();
            const name = document.getElementById('editRouteName').value.trim();
            const interval = document.getElementById('editRouteInterval').value.trim();
            const weekdayTimesStr = document.getElementById('editWeekdayTimes').value.trim();
            const weekendTimesStr = document.getElementById('editWeekendTimes').value.trim();
            const stopsStr = document.getElementById('editRouteStops').value.trim();
            
            const weekdayTimes = weekdayTimesStr ? weekdayTimesStr.split(',').map(t => t.trim()) : [];
            const weekendTimes = weekendTimesStr ? weekendTimesStr.split(',').map(t => t.trim()) : [];
            const stops = stopsStr ? stopsStr.split(',').map(s => s.trim()) : [];
            
            currentRoute.number = number;
            currentRoute.name = name;
            currentRoute.interval = interval;
            currentRoute.weekday = {
                start: weekdayTimes[0] || '‚Äî',
                end: weekdayTimes[weekdayTimes.length - 1] || '‚Äî',
                times: weekdayTimes
            };
            currentRoute.weekend = {
                start: weekendTimes[0] || '‚Äî',
                end: weekendTimes[weekendTimes.length - 1] || '‚Äî',
                times: weekendTimes
            };
            currentRoute.stops = stops;
            
            saveData();
            renderRouteDetail();
            renderRoutes();
            closeModal();
        }

        // Delete route
        function deleteRoute() {
            if (!currentRoute) return;
            
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ä—à—Ä—É—Ç?')) return;
            
            routes = routes.filter(r => r.id !== currentRoute.id);
            saveData();
            backToList();
            renderRoutes();
        }

        // Add announcement modal
        function showAddAnnouncementModal() {
            const body = `
                <div class="form-group">
                    <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                    <input type="text" id="annTitle" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è">
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–µ–∫—Å—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è</label>
                    <textarea id="annText" class="form-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="annUrgent"> –°—Ä–æ—á–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
                    </label>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveAnnouncement()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            `;
            
            showModal('–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ', body, footer);
        }

        // Save announcement
        function saveAnnouncement() {
            const title = document.getElementById('annTitle').value.trim();
            const text = document.getElementById('annText').value.trim();
            const urgent = document.getElementById('annUrgent').checked;
            
            if (!title || !text) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç');
                return;
            }
            
            const announcement = {
                title,
                text,
                urgent,
                date: new Date().toLocaleDateString('ru-RU')
            };
            
            announcements.unshift(announcement);
            saveData();
            renderAnnouncements();
            closeModal();
        }

        // Delete announcement
        function deleteAnnouncement(index) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?')) return;
            
            announcements.splice(index, 1);
            saveData();
            renderAnnouncements();
        }

        // Export data
        function exportData() {
            const data = {
                routes,
                announcements,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bus-schedule-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Import data
        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.routes) {
                        routes = data.routes;
                    }
                    if (data.announcements) {
                        announcements = data.announcements;
                    }
                    
                    saveData();
                    renderRoutes();
                    renderAnnouncements();
                    alert('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
                } catch (err) {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + err.message);
                }
            };
            reader.readAsText(file);
            input.value = '';
        }

        // Reset data
        function resetData() {
            if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫ –Ω–∞—á–∞–ª—å–Ω—ã–º? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è!')) return;
            
            localStorage.removeItem('busRoutes');
            localStorage.removeItem('busAnnouncements');
            routes = [...defaultRoutes];
            announcements = [];
            saveData();
            renderRoutes();
            renderAnnouncements();
            backToList();
        }

        // Close modal on overlay click
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });

        // Initialize on load
        init();
    </script>
</body>
</html>
